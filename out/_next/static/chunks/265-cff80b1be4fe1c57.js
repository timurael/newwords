"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{3265:(e,t,a)=>{a.d(t,{F:()=>l});var r=a(8693),i=a(6786),s=a(8312);let n={totalWords:0,wordsLearned:0,wordsToReview:0,dailyStreak:0,retentionRate:0,averageSessionTime:0},o=e=>e.map(e=>({...e,createdAt:new Date(e.createdAt),nextReview:new Date(e.nextReview),lastReviewed:e.lastReviewed?new Date(e.lastReviewed):void 0})),l=(0,r.vt)()((0,i.lt)((0,i.Zr)((e,t)=>({words:[],currentSession:null,todayQueue:[],stats:n,isLoading:!1,addWord:a=>{let r={id:crypto.randomUUID(),original:a.original,turkishTranslation:a.turkishTranslation,germanTranslation:a.germanTranslation,notes:a.notes||"",examples:a.examples||[],tags:a.tags||[],createdAt:new Date,difficulty:5,stability:1,retrievability:1,nextReview:new Date(Date.now()+864e5),reviewCount:0,lapseCount:0,state:"new"};e(e=>{let a={words:[...e.words,r],stats:t().calculateStats()};return setTimeout(()=>{s.w.createBackup(a.words,a.stats,"auto").catch(e=>console.warn("Backup failed:",e))},100),a})},updateWord:(a,r)=>{e(e=>{let i={words:e.words.map(e=>e.id===a?{...e,...r}:e),stats:t().calculateStats()};return(void 0!==r.reviewCount||void 0!==r.state)&&setTimeout(()=>{s.w.createBackup(i.words,i.stats,"auto").catch(e=>console.warn("Backup failed:",e))},100),i})},deleteWord:a=>{e(e=>{let r={words:e.words.filter(e=>e.id!==a),stats:t().calculateStats()};return setTimeout(()=>{s.w.createBackup(r.words,r.stats,"auto").catch(e=>console.warn("Backup failed:",e))},100),r})},submitReview:async(e,a,r)=>{let i,s=t().words.find(t=>t.id===e);if(!s)return;let n=new Date,o=s.stability,l=s.difficulty,c=s.state;switch(a){case 1:o=Math.max(1,.5*s.stability),l=Math.min(10,s.difficulty+1),c="new"===s.state?"learning":"relearning",i=new Date(n.getTime()+6e5);break;case 2:o=1.2*s.stability,l=Math.min(10,s.difficulty+.5),i=new Date(n.getTime()+.8*o*864e5);break;case 3:o=2*s.stability,"new"===s.state?c="learning":"learning"===s.state&&(c="review"),i=new Date(n.getTime()+24*o*36e5);break;case 4:o=3*s.stability,l=Math.max(1,s.difficulty-.5),c="review",i=new Date(n.getTime()+1.5*o*864e5)}let u=Math.exp(-(s.lastReviewed?(n.getTime()-s.lastReviewed.getTime())/864e5:1)/o);t().updateWord(e,{difficulty:l,stability:o,retrievability:u,lastReviewed:n,nextReview:i,reviewCount:s.reviewCount+1,lapseCount:1===a?s.lapseCount+1:s.lapseCount,state:c})},getTodayQueue:()=>{let a=new Date,r=t().words.filter(e=>e.nextReview<=a);return e({todayQueue:r}),r},startStudySession:()=>{e({currentSession:{id:crypto.randomUUID(),userId:"current-user",startTime:new Date,endTime:new Date,cardsReviewed:0,accuracy:0,averageResponseTime:0,reviews:[]}})},endStudySession:()=>{let a=t().currentSession;a&&e({currentSession:{...a,endTime:new Date}})},calculateStats:()=>{let e=t().words,a=new Date;a.getFullYear(),a.getMonth(),a.getDate();let r=e.length,i=e.filter(e=>"review"===e.state).length,s=e.filter(e=>e.nextReview<=a).length,n=e.filter(e=>e.reviewCount>0),o=n.reduce((e,t)=>e+t.reviewCount,0),l=n.reduce((e,t)=>e+t.lapseCount,0);return{totalWords:r,wordsLearned:i,wordsToReview:s,dailyStreak:0,retentionRate:o>0?Math.round((o-l)/o*100):0,averageSessionTime:0}}}),{name:"word-store",partialize:e=>({words:e.words,stats:e.stats}),onRehydrateStorage:()=>e=>{e&&e.words&&(e.words=o(e.words),e.stats=e.calculateStats())}}),{name:"WordStore"}))},8312:(e,t,a)=>{a.d(t,{i:()=>s,w:()=>i});class r{async initializeDB(){return this.isClient?new Promise((e,t)=>{let a=indexedDB.open(this.dbName,this.dbVersion);a.onerror=()=>t(a.error),a.onsuccess=()=>{this.db=a.result,e()},a.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("backups")){let e=t.createObjectStore("backups",{keyPath:"id"});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1})}t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"id"})}}):Promise.resolve()}generateChecksum(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return t.toString(16)}async createBackup(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";if(!this.isClient)return Promise.resolve("");let r=Date.now(),i="backup_".concat(r,"_").concat(a),s={version:"1.0.0",timestamp:r,words:e.map(e=>({...e,createdAt:new Date(e.createdAt),lastReviewed:e.lastReviewed?new Date(e.lastReviewed):void 0,nextReview:new Date(e.nextReview)})),stats:t,checksum:""},n=JSON.stringify(s);return s.checksum=this.generateChecksum(n),await Promise.all([this.saveToIndexedDB(i,s,a),this.saveToLocalStorage(i,s),this.cleanupOldBackups()]),console.log("âœ… Backup created: ".concat(i," (").concat(e.length," words)")),i}async saveToIndexedDB(e,t,a){return this.isClient?(this.db||await this.initializeDB(),new Promise((r,i)=>{let s=this.db.transaction(["backups","metadata"],"readwrite");s.objectStore("backups").put({id:e,data:t});let n=s.objectStore("metadata"),o={id:e,timestamp:t.timestamp,wordCount:t.words.length,size:JSON.stringify(t).length,type:a,version:t.version};n.put(o),s.oncomplete=()=>r(),s.onerror=()=>i(s.error)})):Promise.resolve()}async saveToLocalStorage(e,t){if(!this.isClient)return Promise.resolve();try{let a=this.compressData(t);localStorage.setItem("wordmemory_backup_".concat(e),a);let r=this.getLocalStorageBackupList();r.push({id:e,timestamp:t.timestamp,wordCount:t.words.length,size:a.length,type:"auto",version:t.version}),r.length>10&&r.splice(0,r.length-10).forEach(e=>{localStorage.removeItem("wordmemory_backup_".concat(e.id))}),localStorage.setItem("wordmemory_backup_list",JSON.stringify(r))}catch(e){console.warn("LocalStorage backup failed:",e)}}compressData(e){return JSON.stringify(e)}getLocalStorageBackupList(){try{let e=localStorage.getItem("wordmemory_backup_list");return e?JSON.parse(e):[]}catch(e){return[]}}async restoreFromBackup(e){try{let t=await this.getFromIndexedDB(e);if(t)if(this.validateBackup(t))return t;else console.warn("Backup ".concat(e," failed integrity check"));let a=this.getFromLocalStorage(e);if(a&&this.validateBackup(a))return a;return null}catch(e){return console.error("Backup restoration failed:",e),null}}async getFromIndexedDB(e){return this.db||await this.initializeDB(),new Promise((t,a)=>{let r=this.db.transaction(["backups"],"readonly").objectStore("backups").get(e);r.onsuccess=()=>{let e=r.result;t(e?e.data:null)},r.onerror=()=>a(r.error)})}getFromLocalStorage(e){try{let t=localStorage.getItem("wordmemory_backup_".concat(e));return t?JSON.parse(t):null}catch(e){return null}}validateBackup(e){try{let{checksum:t,...a}=e,r=this.generateChecksum(JSON.stringify(a));if(t!==r)return console.warn("Backup checksum mismatch - possible corruption"),!1;if(!e.words||!Array.isArray(e.words)||!e.stats||"object"!=typeof e.stats)return!1;return!0}catch(e){return!1}}async exportToFile(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"json",r=new Date().toISOString().split("T")[0],i="wordmemory_export_".concat(r,".").concat(a);if("json"===a){let a={version:"1.0.0",timestamp:Date.now(),words:e,stats:t,checksum:""};a.checksum=this.generateChecksum(JSON.stringify(a)),this.downloadFile(i,JSON.stringify(a,null,2),"application/json")}else{let t=this.convertToCSV(e);this.downloadFile(i,t,"text/csv")}}convertToCSV(e){return["Original,Turkish,German,Notes,Tags,Created,State,Difficulty,Stability,Retrievability,Review Count",...e.map(e=>[this.escapeCsv(e.original),this.escapeCsv(e.turkishTranslation),this.escapeCsv(e.germanTranslation),this.escapeCsv(e.notes||""),this.escapeCsv(e.tags.join("; ")),e.createdAt.toISOString(),e.state,e.difficulty.toString(),e.stability.toString(),e.retrievability.toString(),e.reviewCount.toString()]).map(e=>e.join(","))].join("\n")}escapeCsv(e){return e.includes(",")||e.includes('"')||e.includes("\n")?'"'.concat(e.replace(/"/g,'""'),'"'):e}downloadFile(e,t,a){let r=new Blob([t],{type:a}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)}async importFromFile(e){try{let t=await e.text();if(e.name.endsWith(".json")){let e=JSON.parse(t);if(this.validateBackup(e))return e}else if(e.name.endsWith(".csv")){let e=this.parseCSV(t);return{version:"1.0.0",timestamp:Date.now(),words:e,stats:{totalWords:e.length,wordsLearned:0,wordsToReview:e.length,dailyStreak:0,retentionRate:0,averageSessionTime:0},checksum:""}}return null}catch(e){return console.error("Import failed:",e),null}}parseCSV(e){let t=e.split("\n");return t[0].split(","),t.slice(1).filter(e=>e.trim()).map((e,t)=>{let a=this.parseCSVLine(e);return{id:crypto.randomUUID(),original:a[0]||"",turkishTranslation:a[1]||"",germanTranslation:a[2]||"",notes:a[3]||"",tags:a[4]?a[4].split("; "):[],createdAt:a[5]?new Date(a[5]):new Date,state:a[6]||"new",difficulty:parseFloat(a[7])||5,stability:parseFloat(a[8])||1,retrievability:parseFloat(a[9])||1,nextReview:new Date(Date.now()+864e5),reviewCount:parseInt(a[10])||0,lapseCount:0}})}parseCSVLine(e){let t=[],a="",r=!1,i=0;for(;i<e.length;){let s=e[i];'"'===s&&(0===i||","===e[i-1])?r=!0:'"'===s&&r&&(i===e.length-1||","===e[i+1])?r=!1:","!==s||r?a+=s:(t.push(a),a=""),i++}return t.push(a),t}async getAllBackupMetadata(){return this.db||await this.initializeDB(),new Promise((e,t)=>{let a=this.db.transaction(["metadata"],"readonly").objectStore("metadata").getAll();a.onsuccess=()=>e(a.result),a.onerror=()=>t(a.error)})}async cleanupOldBackups(){try{let e=(await this.getAllBackupMetadata()).filter(e=>"auto"===e.type).sort((e,t)=>t.timestamp-e.timestamp).slice(50);if(e.length>0&&this.db){let t=this.db.transaction(["backups","metadata"],"readwrite"),a=t.objectStore("backups"),r=t.objectStore("metadata");e.forEach(e=>{a.delete(e.id),r.delete(e.id)})}}catch(e){console.warn("Backup cleanup failed:",e)}}startAutoBackup(){this.backupInterval=setInterval(()=>{},3e5)}stopAutoBackup(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null)}async getStorageStats(){let e=await this.getAllBackupMetadata();return{indexedDB:e.reduce((e,t)=>e+t.size,0),localStorage:this.getLocalStorageBackupList().reduce((e,t)=>e+t.size,0),totalBackups:e.length}}constructor(){this.dbName="WordMemoryBackup",this.dbVersion=1,this.db=null,this.backupInterval=null,this.isClient=!0,this.isClient&&(this.initializeDB(),this.startAutoBackup())}}let i=new r,s=()=>({createBackup:i.createBackup.bind(i),restoreBackup:i.restoreFromBackup.bind(i),exportToFile:i.exportToFile.bind(i),importFromFile:i.importFromFile.bind(i),getAllBackupMetadata:i.getAllBackupMetadata.bind(i),getStorageStats:i.getStorageStats.bind(i)})}}]);